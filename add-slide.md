---
description: 授業計画に基づいて新しいスライドセクションを完全自動で追加する
---

# 新規スライドセクションの追加 (完全自動実行モード)

**重要:** このワークフローは、ユーザーの介入なしに、開始から完了まで完全に自動で実行されるように設計されています。各ステップは完了後、ただちに次のステップへ移行してください。思考の途中でユーザーに確認を求めたり、作業を中断したりしないでください。

**引数:** スライドテーマ/トピック名 (例: `/add-slide 放射線の種類と特性`)

---

## ステップ1: 準備とコンテキスト設定

1. 現在のタスクコンテキストを確立する:
  - スライドテーマ: `[引数で与えられたテーマ名]`
  - 日付: `[現在の日付をYYYYMMDD形式で取得]`
  - プランニングディレクトリパス: `.slide-planning/[日付]-[テーマ名]/`
2. 上記プランニングディレクトリを作成する。
3. 以下の3つの空ファイルを作成する:
  - `[プランニングディレクトリパス]/requirements.md`
  - `[プランニングディレクトリパス]/design.md`
  - `[プランニングディレクトリパス]/tasklist.md`

## ステップ2: プロジェクト理解

1. `CLAUDE.md`を読み、プロジェクトの全体像とスライド作成ルールを把握する。
2. `lesson_plan/`ディレクトリ内のドキュメントを確認し、授業の構成と今回のテーマの位置づけを理解する。
  - `lesson_plan/第1回授業の全体像.md`
  - `lesson_plan/本論部分の詳細.md`
3. `slidev_write.md`でSlidevの基本機能を確認する。
4. `format/template_sides.md`でスライドの基本フォーマットを確認する。

## ステップ3: 既存パターンの調査

1. `slides.md`を読み、現在のスライド構成とスタイルを理解する。
2. `pages/`ディレクトリ内の既存スライドを確認し、使用されているレイアウトやコンポーネントのパターンを特定する。
3. Grepツールを使用し、テーマに関連するキーワードでスライドを検索する。
  ```bash
  Grep('[テーマに関連するキーワード]', 'slides.md')
  Grep('[テーマに関連するキーワード]', 'pages/')
  ```
4. 検索結果を分析し、以下を特定する:
  - 既存の命名規則
  - レイアウトパターン（2カラム、画像配置など）
  - アイコンの使用方法
  - 文字サイズとスタイル
  - スライド間の区切り方

## ステップ4: 計画フェーズ (プランニングファイルの自動生成)

1. ステップ1で作成した3つのファイルに以下の内容を記述する:

**requirements.md:**
  - スライドテーマの目的と学習目標
  - 対象となる受講者（医学生、何年生か）
  - カバーすべき内容の範囲
  - 授業計画との整合性
  - 推定スライド枚数

**design.md:**
  - スライド構成（導入→本論→まとめ）
  - 各スライドのタイトルと概要
  - 使用するレイアウトパターン
  - 必要な図表・画像のリスト
  - アイコンの使用計画
  - 参考文献の記載方法

**tasklist.md:**
  - [ ] スライドの基本構造を作成
  - [ ] 導入スライドの作成
  - [ ] 本論スライド（複数）の作成
  - [ ] まとめスライドの作成
  - [ ] 図表・画像の配置
  - [ ] アイコンの追加
  - [ ] フォーマットチェック（タイトルと内容の間のスペース確認）
  - [ ] 文字サイズチェック（28pt以上）
  - [ ] レイアウト最適化
  - [ ] プレビュー確認

2. **このステップが正常に完了したら、決して停止せず、ただちにステップ5に進むこと。**

## ステップ5: 実装ループ (tasklist.mdの完全消化)

**このステップは、`tasklist.md`の全タスクが `[x]` になるまで自動で繰り返されるループ処理です。**
**このステップが正常に完了したら、決して停止せず、ただちにステップ6に進むこと。**

**ループ開始:**

1. タスクリストの読み込み:
  - `[プランニングディレクトリパス]/tasklist.md`ファイルを読み込む。

2. 進捗の確認:
  - ファイル内に未完了タスク (`[ ]`) が存在するか確認する。
  - **もし未完了タスクが存在しない場合:** この実装ループは完了とみなし、ただちに**ステップ6**へ進む。
  - **もし未完了タスクが存在する場合:** 次の処理（3. タスクの実行）に進む。

3. タスクの実行:
  - `tasklist.md`の**先頭にある未完了タスク**を1つ特定する。
  - そのタスクを完了させるために必要な実装作業を実行する。
  - 以下のルールを遵守する:
    - スライドは`slides.md`または`pages/`内の新規ファイルに追加
    - 各スライドは`---`で区切る
    - タイトルと内容の間に`***`と`<div class="mt-5"></div>`を挿入
    - 本文の文字サイズは28pt以上を基本とする
    - 画像は`public/`に保存し、適切に配置
    - 適切なアイコンを`@iconify-json/mdi`から選択
    - `format/template_sides.md`のフォーマットに従う
    - 既存のレイアウトパターンを踏襲

4. タスクリストの更新:
  - 実行したタスクが完了したら、`Edit`ツールを使用して`tasklist.md`を更新し、該当タスクを `[ ]` から `[x]` に変更する。

5. ループ継続:
  - **ステップ5の先頭 (1. タスクリストの読み込み) に戻り、処理を繰り返す。**

---
### ※ 実装ループ内の例外処理ルール ※

実装ループの実行中に以下の状況が発生した場合は、このルールに従って自律的に対処し、ループを継続すること。

- **ルールA: タスクが大きすぎる場合**
  - **対処法:** 現在のタスクをより小さな複数のサブタスクに分割する。`Edit`ツールを使い、元のタスクを削除し、その場所に新しいサブタスク（`[ ]`付き）を挿入する。その後、ループを継続する。

- **ルールB: 技術的理由でタスクが不要になった場合**
  - **条件:** スライド構成の変更、レイアウトの変更、授業計画との整合性など、明確な教育的・技術的理由がある場合にのみ適用。
  - **対処法:** `Edit`ツールを使い、該当タスクを `[x] ~~タスク名~~ (理由: [具体的な理由を簡潔に記述])` の形式で更新する。その後、ループを継続する。

- **❌ 絶対禁止の行為:**
  - 未完了タスクを「後でやる」「別タスクにする」などの理由で意図的にスキップすること。
  - 理由なく未完了タスクを放置してループを終了させること。
  - ユーザーに判断を仰ぐこと。

---

## ステップ6: プレビュー確認

1. 開発サーバーが起動していない場合、Bashツールで`npm run dev`を実行する（バックグラウンド実行）。
2. ブラウザでプレビューを確認し、以下をチェック:
  - レイアウトの崩れがないか
  - 文字サイズが適切か（28pt以上）
  - 画像が正しく表示されているか
  - アイコンが適切に表示されているか
  - スライド間の遷移がスムーズか

**このステップが正常に完了したら、決して停止せず、ただちにステップ7に進むこと。**

## ステップ7: フォーマット検証

1. 作成したスライドが以下の要件を満たしているか確認する:
  - タイトルと内容の間に`***`と`<div class="mt-5"></div>`が挿入されているか
  - 本文の文字サイズは28pt以上か
  - 各スライドは`---`で適切に区切られているか
  - 画像ファイルは`public/`に保存されているか
  - アイコンは適切に選択されているか
  - 既存のスタイルパターンに従っているか

2. 問題があれば修正し、再度確認する。

**このステップが正常に完了したら、決して停止せず、ただちにステップ8に進むこと。**

## ステップ8: 振り返りとドキュメント更新

1. `tasklist.md`に申し送り事項を記載する:
  - 実装完了日時
  - 作成したスライド枚数
  - 使用したレイアウトパターン
  - 追加した画像・アイコンのリスト
  - 計画と実績の差分
  - 学んだこと
  - 次回への改善提案
  - 授業計画との整合性確認結果

2. 今回の追加が授業全体の流れに影響を与えるか判断する。

3. 影響がある場合、`lesson_plan/`内の関連ドキュメントを`Edit`ツールで更新する。

4. `issue.md`に記載されている改善点のうち、今回対応したものがあれば記録する。

## 完了条件

このワークフローは、以下の全ての条件を満たした時点で自動的に完了となる。

- ステップ5: `tasklist.md`の全てのタスクが完了状態（`[x]`または正当な理由でスキップ）になっている。
- ステップ6: プレビューで表示が確認されている。
- ステップ7: フォーマット検証をパスしている。
- ステップ8: `tasklist.md`に申し送り事項が記載されている。

この完了条件を満たすまで、自律的に思考し、問題解決を行い、作業を継続すること。

## 補足: スライド作成時の重要なポイント

### フォーマット規則
```markdown
# スライドタイトル

***

<div class="mt-5"></div>

スライドの内容（28pt以上）
```

### 画像の配置例
```markdown
<div class="flex justify-center mt-5">
  <img src="/images/example.png" class="h-80" alt="説明">
</div>
```

### アイコンの使用例
```markdown
<mdi-radioactive class="text-4xl text-yellow-500" />
```

### 2カラムレイアウト例
```markdown
<div class="grid grid-cols-2 gap-4">
  <div>
    左側の内容
  </div>
  <div>
    右側の内容
  </div>
</div>
```

### 参考文献の記載例
```markdown
<div class="text-sm mt-10">
参考文献: 著者名. 論文タイトル. 雑誌名. 年; 巻(号): ページ.
</div>
```
