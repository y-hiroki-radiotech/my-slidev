# Slidev用図解生成（画像生成 + ページ指定対応）

## 入力形式
$ARGUMENTS

以下の形式で指定してください：
- 説明文: [図解したい内容]
- ページ: [挿入先のページ番号またはスライドID]（任意）
- スライドファイル: [対象のmdファイルパス]（任意、デフォルト: slides.md）

例: 「放射線治療のワークフローを図解して。ページ5に挿入、slides.md」

---

## 作業手順

### Step 1: 図解の種類を判定

説明文の内容から最適な図解形式を選択：

| 内容                   | 図解形式                     |
| ---------------------- | ---------------------------- |
| プロセス・手順・フロー | Mermaid flowchart + 補足画像 |
| 概念の関係性・構造     | AI画像生成（概念図）         |
| 機器・装置の説明       | AI画像生成（イラスト/図解）  |
| データの可視化         | Mermaid + チャート           |
| 抽象的な概念           | AI画像生成（メタファー図解） |
| 比較・対比             | AI画像生成 または Mermaid    |

### Step 2: 画像/図解の生成

#### AI画像生成の場合
1. 説明文から図解に適したプロンプトを作成
2. 画像生成を実行
3. 生成された画像をプレビュー表示

#### Mermaid図の場合
1. Mermaidコードを生成
2. SVGとしてエクスポート
3. プレビュー表示

### Step 3: ファイル保存
- 保存先: `images/` フォルダ
- ファイル名: 内容を反映したケバブケース
  - 例: `radiation-therapy-workflow.png`
  - 例: `ct-scanner-diagram.png`
  - 例: `treatment-planning-flow.svg`

### Step 4: プレビューと承認依頼

以下の形式でユーザーに表示：

---
📊 **生成した図解**

[画像をプレビュー表示]

📁 **保存先**: `images/[ファイル名]`

📄 **挿入先**: [指定されたページ情報、または「未指定」]

---
✅ **確認してください**

1. **図解の内容**: この図解でよろしいですか？
2. **挿入先**: ページ番号を指定または変更しますか？

**操作方法**:
- 承認: 「OK」「承認」「これでいい」
- 修正: 「〇〇を変更して」「色を〇〇に」「要素を追加して」
- ページ指定: 「ページ3に入れて」「スライド5」
---

### Step 5: 修正対応

修正指示を受けた場合：
1. 指示内容を反映して再生成
2. ファイルを上書き保存
3. 再度プレビューを表示して承認を求める

承認されるまで繰り返す。

### Step 6: Slidevスライドへの挿入

承認後、指定されたページに画像を挿入：

1. 対象のSlidevマークダウンファイルを読み込み
2. 指定ページ（`---`で区切られたセクション）を特定
3. レイアウトを含めて更新

#### レイアウトオプションの提案

挿入時に以下のレイアウトを提案：

**A. 画像中央配置（デフォルト）**
~~~markdown
---
layout: center
---

# [既存または新規タイトル]

![図解の説明](./images/[ファイル名])
~~~

**B. 画像 + テキスト（左右分割）**
~~~markdown
---
layout: two-cols
---

# [タイトル]

[左側のテキスト説明]

::right::

![図解](./images/[ファイル名])
~~~

**C. 画像 + テキスト（上下配置）**
~~~markdown
---
layout: default
---

# [タイトル]

![図解](./images/[ファイル名])

[下部の説明テキスト]
~~~

**D. 全画面画像**
~~~markdown
---
layout: image
image: ./images/[ファイル名]
---
~~~

**E. 背景画像 + オーバーレイテキスト**
~~~markdown
---
layout: image
image: ./images/[ファイル名]
class: text-white
---

# [タイトル]

[オーバーレイテキスト]
~~~

### Step 7: レイアウト確認と最終承認

スライド更新後、変更内容をプレビュー：

---
📝 **スライド更新プレビュー**

**ファイル**: `[スライドファイル名]`
**ページ**: [ページ番号]
**レイアウト**: [選択されたレイアウト]
```markdown
[更新後のスライドマークダウン]
```

---
✅ このレイアウトでスライドを更新してよろしいですか？
- 承認: 「OK」
- レイアウト変更: 「Bのレイアウトにして」「左右逆にして」
- キャンセル: 「やめる」「保留」
---

承認後、スライドファイルを実際に更新。

---

## 補足ルール

### ページの特定方法
Slidevのマークダウンは `---` で区切られる。ページ番号は1始まり。

例: ページ3を特定
```markdown
---        ← ページ1開始
# スライド1
---        ← ページ2開始
# スライド2
---        ← ページ3開始（ここが対象）
# スライド3
---
```

### 既存コンテンツの扱い
- 既存タイトルは維持（変更指示がない限り）
- 既存テキストは可能な限り維持
- 画像の追加/置換のみ実行
- 大幅な変更が必要な場合は事前確認

### エラーハンドリング
- 指定ページが存在しない → 新規ページ追加を提案
- ファイルが見つからない → パスの確認を依頼
- 画像生成失敗 → 代替案（Mermaid等）を提案
