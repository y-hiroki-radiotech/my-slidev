---
name: add-notes
description: 既存スライドにプレゼンター用スピーカーノートを追加する
tools: [Read, Write, Edit, Glob, Grep, Bash, AskUserQuestion]
---

# スピーカーノートの追加

**引数:**
- `/add-notes` - slides.md全体にノート追加
- `/add-notes 3-10` - スライド3-10のみ
- `/add-notes pages/section.md` - 特定ファイル

このスキルは、ユーザーの介入なしに、開始から完了まで完全に自動で実行されます。各ステップは完了後、ただちに次のステップへ移行してください。

## Slidevノート記法

```markdown
# スライドタイトル

メインコンテンツ

<!--
プレゼンターノート：
- ポイント1
- ポイント2
- 時間配分に注意
-->

---
```

## 実行フロー

### Phase 0.5: ノート要件確認

AskUserQuestion tool で以下を確認:

**Question 1: ノートの詳細度**
- Header: "詳細度"
- multiSelect: false
- Options:
  - label: "簡潔"
    description: "3-5箇条書きの要点のみ"
  - label: "標準（推奨）"
    description: "トーキングポイント付きの標準的な詳しさ"
  - label: "詳細"
    description: "スクリプト付きの完全な台本"

**Question 2: 含める要素**
- Header: "要素"
- multiSelect: true
- Options:
  - label: "トーキングポイント（推奨）"
    description: "話すべき要点のリスト"
  - label: "時間配分"
    description: "各スライドの推奨時間"
  - label: "トランジションヒント"
    description: "次のスライドへの橋渡し"
  - label: "強調ポイント"
    description: "特に強調すべきキーメッセージ"

**Question 3: ノートの言語**
- Header: "言語"
- multiSelect: false
- Options:
  - label: "日本語（推奨）"
    description: "日本語でノートを作成"
  - label: "英語"
    description: "英語でノートを作成"

これらの回答を受けて、ノート生成の方針を決定する。

### ステップ1: 準備とコンテキスト設定

1. 現在のタスクコンテキストを確立:
   - 対象ファイル: ユーザー指定のファイル（デフォルト: slides.md）
   - 対象範囲: 指定されたスライド番号（デフォルト: 全スライド）
   - 日付: 現在の日付をYYYYMMDD形式で取得

2. プランニングディレクトリを作成:
   ```
   .notes-planning/[YYYYMMDD]-[filename]/
   ├── slide-analysis.md   # 各スライドの分析結果
   ├── notes-draft.md      # ノート下書き
   └── tasklist.md         # タスク管理
   ```

### ステップ2: プロジェクト理解

以下のファイルを読み込み、プロジェクトルールを理解:
- `CLAUDE.md` - プロジェクト全体像
- `.claude/docs/style-guide.md` - スタイルガイド（存在する場合）
- `lesson_plan/` 内の関連計画ファイル（存在する場合）

### ステップ3: 変更前のgit commit

1. 現在のgit statusを確認
2. 変更がある場合は、ユーザーの変更をコミット
3. 変更前の状態を保存:
   ```bash
   git add -A && git commit -m "Before adding speaker notes"
   ```

### ステップ4: スライド分析

対象スライドを分析し、`slide-analysis.md`に記録:

1. 各スライドのタイプを判定:
   - **タイトルスライド**: 最初のスライド、講義タイトルが含まれる
   - **セクション区切り**: 新しいセクションの開始、シンプルなタイトルのみ
   - **内容スライド**: 本文、リスト、画像等のコンテンツあり
   - **まとめスライド**: "まとめ"、"Take-home"等のキーワード

2. 各スライドの分析結果を記録:
   ```markdown
   ## スライド1
   - タイプ: タイトルスライド
   - タイトル: プレゼンテーション概要
   - 主要コンテンツ: 講義の導入
   - 推奨時間: 1分
   ```

### ステップ5: ノート生成計画

`notes-draft.md`に各スライドのノート下書きを作成:

**スライドタイプ別ガイドライン:**

| タイプ | 時間 | ノート内容 |
|--------|------|------------|
| タイトル | 1分 | 導入、概要説明、聴衆への挨拶 |
| セクション区切り | 30秒 | トランジション、次セクションの予告 |
| 内容スライド | 2-3分 | 詳細なトーキングポイント、補足情報 |
| まとめ | 2分 | 再強調、Take-homeメッセージ |

**ノートフォーマット（詳細度による）:**

簡潔モード:
```markdown
<!--
- ポイント1
- ポイント2
- ポイント3
-->
```

標準モード:
```markdown
<!--
[時間: X分]

### トーキングポイント
- ポイント1
- ポイント2

### 強調
「キーメッセージ」を必ず伝える

### トランジション
→ 次は〇〇について
-->
```

詳細モード:
```markdown
<!--
[時間: X分]

### スクリプト
「ここでは〇〇について説明します。まず...」

### トーキングポイント
- ポイント1の詳細説明
- ポイント2の詳細説明

### 聴衆への質問
「〇〇について、皆さんはどう思いますか？」

### 補足情報
参考: 〇〇の研究によると...

### 強調
「キーメッセージ」を必ず伝える

### トランジション
→ 次は〇〇について
-->
```

### ステップ6: タスクリスト作成

`tasklist.md`を作成:
```markdown
# ノート追加タスクリスト

## 対象ファイル
- ファイル: slides.md
- 範囲: 全スライド（または指定範囲）

## タスク
- [ ] スライド1にノート追加
- [ ] スライド2にノート追加
- [ ] スライド3にノート追加
...
- [ ] プレビュー確認
- [ ] フォーマット検証
```

### ステップ7: 実装ループ

`tasklist.md`の全タスクが完了するまで以下を繰り返す:

1. tasklist.mdを読み込む
2. 未完了タスク（`[ ]`）を確認
3. 先頭の未完了タスクを実行:
   - `notes-draft.md`から該当スライドのノートを取得
   - スライドの`---`の直前にノートを挿入
   - 既存のノートがある場合は上書きせず、マージまたはスキップ
4. タスクを`[x]`に更新
5. 次のタスクへ

**ノート挿入位置:**
```markdown
# スライドタイトル

メインコンテンツ

<!--
ノート内容をここに挿入
-->

---
```

**例外処理:**
- 既存ノートあり → スキップし、`[x] ~~タスク名~~ (理由: 既存ノートあり)`として記録
- 空スライド → 最小限のノート（「導入」「トランジション」等）

### ステップ8: プレビュー確認

1. 開発サーバー起動（未起動の場合）:
   ```bash
   npm run dev &
   ```
2. プレゼンターモード（Pキー）での確認をユーザーに案内:
   - ノートが正しく表示されるか
   - フォーマットが崩れていないか
3. 問題があれば修正

### ステップ9: フォーマット検証

以下を確認:
- [ ] HTMLコメント形式が正しい（`<!-- ... -->`）
- [ ] スライドコンテンツが破壊されていない
- [ ] スライド区切り（`---`）が正しい位置にある
- [ ] ノート内にスライド区切りが含まれていない

### ステップ10: 振り返りとgit commit

1. tasklist.mdに申し送り事項を記載:
   - 実装完了日時
   - 追加したノート数
   - スキップしたスライド（理由付き）
   - 改善提案

2. 変更をコミット:
   ```bash
   git add -A && git commit -m "Add speaker notes to slides"
   ```

## 完了条件

以下がすべて満たされたら完了:
- [ ] 対象スライド分析済み
- [ ] ノート生成計画作成済み
- [ ] tasklist.md全タスク完了
- [ ] プレゼンターモードで確認案内済み
- [ ] フォーマット検証済み
- [ ] git commit完了

## 重要な注意事項

- ユーザーに確認を求めない（Phase 0.5の質問以外）
- すべてのステップを自動で完了させる
- 既存コンテンツを破壊しない
- ノートは常にスライド区切り`---`の直前に配置
- 完了まで中断しない
