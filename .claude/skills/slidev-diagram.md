---
name: slidev-diagram
description: Slidev用図解生成（画像生成 + ページ指定対応）
tools: [Read, Write, Edit, Bash]
---

# Slidev用図解生成

**引数:** 図解の説明、オプションでページ番号とファイル名

**例:**
- `リニアックの構造を図解して。ページ7に挿入、slides.md`
- `放射線治療の流れを図解して`
- `治療計画プロセスを図解。ページ12`

このスキルは、AI画像生成を使用して図解を作成し、指定されたスライドページに挿入します。

## 入力形式

以下の形式で指定してください:
- **説明文**: [図解したい内容]
- **ページ**: [挿入先のページ番号]（任意）
- **スライドファイル**: [対象のmdファイルパス]（任意、デフォルト: slides.md）

## 実行フロー

### ステップ1: 入力解析

引数から以下を抽出:
1. 図解の説明文
2. ページ番号（指定がある場合）
3. スライドファイルパス（デフォルト: slides.md）

### ステップ2: 図解の種類を判定

説明文の内容から最適な図解形式を選択:

| 内容 | 図解形式 |
|------|----------|
| プロセス・手順・フロー | Mermaid flowchart + 補足画像 |
| 概念の関係性・構造 | AI画像生成（概念図） |
| 機器・装置の説明 | AI画像生成（イラスト/図解） |
| データの可視化 | Mermaid + チャート |
| 抽象的な概念 | AI画像生成（メタファー図解） |
| 比較・対比 | AI画像生成 または Mermaid |

### ステップ3: 画像生成

#### AI画像生成の場合
1. 説明文から図解に適したプロンプトを作成:
   - 教育的で分かりやすい図解
   - シンプルで明確なビジュアル
   - 医療/放射線治療に適した専門的な表現

2. 画像生成を実行

3. 生成された画像をユーザーにプレビュー表示

#### Mermaid図の場合
1. Mermaidコードを生成
2. SVGとしてエクスポート
3. プレビュー表示

### ステップ4: ファイル保存

- **保存先**: `images/` フォルダ
- **ファイル名**: 内容を反映したケバブケース（英語）
  - 例: `radiation-therapy-workflow.png`
  - 例: `ct-scanner-diagram.png`
  - 例: `linac-device-structure.png`

### ステップ5: ユーザー承認

生成された画像を表示し、ユーザーに確認:

```
📊 生成した図解

[画像をプレビュー表示]

📁 保存先: images/[ファイル名].png
📄 挿入先: [スライドファイル] ページ[番号]

✅ 確認してください
1. 図解の内容はよろしいですか？
2. レイアウトを選択してください:
   A. 画像中央配置（center）
   B. 画像+テキスト左右分割（two-cols）
   C. 画像+テキスト上下配置（default）
   D. 画像右側配置（image-right）
   E. 画像左側配置（image-left）
```

**修正が必要な場合**:
- ユーザーからの修正指示を受け取る
- 画像を再生成
- 再度プレビュー表示

### ステップ6: スライドファイルの読み込み

ページ番号が指定されている場合:
1. 対象スライドファイルを読み込む
2. `---`区切りでページを特定（1始まり）
3. 指定されたページの内容を取得

### ステップ7: レイアウト選択

ユーザーが選択したレイアウトに基づいて、スライドコードを生成:

#### A. 画像中央配置（center）
```markdown
---
layout: center
---

# [既存のタイトル]

![図解説明](./images/[ファイル名].png)
```

#### B. 左右分割（two-cols）
```markdown
---
layout: two-cols
---

# [既存のタイトル]

***

<div class="mt-5"></div>

[既存のテキストまたは説明]

::right::

![図解説明](./images/[ファイル名].png)
```

#### C. 上下配置（default）
```markdown
---
---

# [既存のタイトル]

***

<div class="mt-5"></div>

[既存のテキストまたは説明]

<div class="mt-10"></div>

![図解説明](./images/[ファイル名].png)
```

#### D. 画像右側配置（image-right）
```markdown
---
layout: image-right
image: ./images/[ファイル名].png
---

# [既存のタイトル]

***

<div class="mt-5"></div>

[既存のテキストまたは説明]
```

#### E. 画像左側配置（image-left）
```markdown
---
layout: image-left
image: ./images/[ファイル名].png
---

# [既存のタイトル]

***

<div class="mt-5"></div>

[既存のテキストまたは説明]
```

### ステップ8: スライド更新プレビュー

更新後のスライド内容をプレビュー表示:

```
📝 スライド更新プレビュー
ファイル: [スライドファイル]
ページ: [番号]
レイアウト: [選択されたレイアウト]

[マークダウンコードを表示]

✅ このレイアウトでスライドを更新してよろしいですか？
```

### ステップ9: スライドの更新

ユーザー承認後:
1. Editツールを使用してスライドを更新
2. 既存コンテンツを可能な限り維持
3. レイアウトを適用

### ステップ10: 完了報告

```
✅ 完了しました

- 画像保存: images/[ファイル名].png
- スライド更新: [スライドファイル] ページ[番号]

プレビューで確認してください: `npm run dev`
```

## Slidev操作ルール

- **ページ指定**: 1始まりの番号
- **ページ区切り**: `---`でページを特定
- **レイアウト変更**: フロントマターで指定
- **既存コンテンツ**: 可能な限り維持
- **更新前確認**: 必ずプレビューで確認

## 対応レイアウト

### center
画像を中央に配置。タイトルと画像のみのシンプルな構成。

### two-cols
左右2カラム。左側にテキスト、右側に画像。

### default
上下配置。タイトル、テキスト、画像の順。

### image-right
画像を右側に固定表示。左側にテキスト。

### image-left
画像を左側に固定表示。右側にテキスト。

### image
全画面に画像を表示。背景画像として使用。

## 画像生成のガイドライン

### プロンプト作成
- 教育的で分かりやすい図解
- シンプルで明確なビジュアル
- 医療/放射線治療に適した専門的な表現
- ラベルや説明文を含む
- 適切な配色（プライマリカラー: #1e3a8a）

### ファイル命名規則
- ケバブケース（英語）
- 内容を反映した名前
- 例: `linac-structure.png`, `treatment-workflow.png`

### 保存先
- すべて`images/`フォルダに保存
- 相対パスで参照: `./images/[ファイル名].png`

## 注意事項

- 画像生成後は必ずユーザー承認を得る
- 既存のスライド内容を上書きしない
- レイアウト変更時は選択肢を提示
- 更新前に必ずプレビューで確認
- ファイル名は英語のケバブケース

## トラブルシューティング

### 画像が表示されない
- ファイルパスが正しいか確認
- `images/`フォルダに保存されているか確認
- 相対パス`./images/`を使用

### レイアウトが崩れる
- フロントマターの設定を確認
- `---`区切りが正しいか確認
- レイアウトパターンを変更

### ページが見つからない
- ページ番号を確認（1始まり）
- `---`区切りの数を確認
- スライドファイルパスを確認

## 完了条件

- 画像生成完了
- ファイル保存完了（images/フォルダ）
- ユーザー承認取得
- スライド更新完了（ページ指定がある場合）
- プレビュー確認の案内

## 参照ドキュメント
- `CLAUDE.md`: プロジェクト全体のルール
- `docs/style-guide.md`: スタイルガイド
- `format/layout-patterns.md`: レイアウトパターン集
