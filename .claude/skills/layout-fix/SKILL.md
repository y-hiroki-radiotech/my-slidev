---
name: layout-fix
description: スライドのレイアウト崩れを検出して自動修正する
tools: [Read, Write, Edit, Bash, Glob]
---

# レイアウト崩れ自動修正

**引数:** スライドファイルパス

**例:**
- `slides.md` - メインスライドファイルをチェック
- `pages/flowchart.md` - 特定ファイルをチェック

このスキルは、レイアウト崩れを検出し、`format/layout-patterns.md`に基づいて自動修正します。

## 実行フロー

### ステップ1: 準備とコンテキスト設定

1. タスクコンテキストを確立:
  - 対象ファイル: 引数で指定されたスライドファイル
  - 日付: YYYYMMDD形式
  - プランニングディレクトリ: `.layout-planning/[日付]-[ファイル名]/`

2. プランニングファイルを作成:
  - `layout-analysis.md` (レイアウト分析結果)
  - `issues-found.md` (検出された問題)
  - `fix-plan.md` (修正計画)
  - `tasklist.md` (タスクリスト)

### ステップ2: プロジェクト理解

1. 参照ドキュメントを読み込む:
  - `CLAUDE.md` - プロジェクト全体のルール
  - `docs/style-guide.md` - スタイルガイド
  - `format/layout-patterns.md` - レイアウトパターン集

2. 対象ファイルを読み込み、全スライドを取得

### ステップ3: git commitで現在の状態を保存

```bash
git add [対象ファイル]
git commit -m "Before layout fix: [ファイル名]

Co-Authored-By: Claude Sonnet 4.5 <noreply@anthropic.com>"
```

### ステップ4: 開発サーバーの起動

既に起動していない場合:
```bash
bash scripts/start-server.sh &
```

### ステップ5: レイアウト分析

各スライドについて以下をチェック:

#### 5-1. コンテンツ量の確認

**リスト項目過多**:
- 症状: リストアイテムが5個以上
- 問題: 情報過多で読みにくい
- 修正: 2つのスライドに分割

**テキストオーバーフロー**:
- 症状: 1スライドあたり300文字超
- 問題: 文字が小さくなる、読みづらい
- 修正: 要約または複数スライドに分割

**段落数過多**:
- 症状: 3段落以上
- 問題: 情報密度が高すぎる
- 修正: 箇条書きに変換、または分割

#### 5-2. レイアウトの整合性

**タイトル間隔不足**:
- 症状: タイトルと本文の間に`***`と`<div class="mt-5"></div>`がない
- 問題: タイトルと本文が詰まって見える
- 修正: `***`と`<div class="mt-5"></div>`を追加

**不適切なレイアウト選択**:
- 症状: コンテンツに合わないレイアウト
- 問題: 画像とテキストのバランスが悪い
- 修正: `format/layout-patterns.md`から最適なパターンを選択

**画像配置の問題**:
- 症状: 画像が大きすぎる/小さすぎる
- 問題: レイアウトが崩れる
- 修正: two-cols、image-right等に変更

#### 5-3. スタイルの一貫性

**フォントサイズ不足**:
- 症状: 本文が28pt未満（`text-base`以下）
- 問題: 読みづらい
- 修正: `text-xl`または`text-2xl`クラスを追加

**余白不足**:
- 症状: mt-5、mb-5などの余白クラスがない
- 問題: 要素が詰まって見える
- 修正: 適切な余白クラスを追加

**色の使用不適切**:
- 症状: プライマリカラー以外の多用
- 問題: 統一感がない
- 修正: プライマリカラー（#1e3a8a）に統一

### ステップ6: 問題の記録

issues-found.mdに検出された問題を記録:

```markdown
# レイアウト分析結果

ファイル: [ファイル名]
総スライド数: [数]
問題のあるスライド数: [数]

## 検出された問題

### スライド [番号]: [タイトル]

**問題1: リスト項目過多**
- 現在: 7項目
- 推奨: 4項目以内
- 修正案: 2スライドに分割

**問題2: タイトル間隔不足**
- 問題: `***`がない
- 修正案: `***`と`<div class="mt-5"></div>`を追加

### スライド [番号]: [タイトル]

**問題1: テキストオーバーフロー**
- 現在: 420文字
- 推奨: 300文字以内
- 修正案: 要約または分割

**問題2: 画像とテキストのバランス不良**
- 問題: 画像が大きすぎてテキストが読めない
- 修正案: two-colsレイアウトに変更
```

### ステップ7: 修正計画の作成

fix-plan.mdに修正計画を記録:

```markdown
# 修正計画

## スライド [番号]: [タイトル]

### 修正内容
1. リストを2スライドに分割
2. タイトル間隔を追加（`***` + `<div class="mt-5"></div>`）
3. フォントサイズを`text-xl`に変更

### 修正後のレイアウト
- レイアウト: default → two-cols
- 分割: 1スライド → 2スライド

## スライド [番号]: [タイトル]

### 修正内容
1. テキストを要約（420文字 → 250文字）
2. 画像配置を変更（全画面 → image-right）
3. 余白を追加（mt-5, mb-5）

### 修正後のレイアウト
- レイアウト: default → image-right
```

### ステップ8: 修正案の提示

ユーザーに修正案を提示:

```
📊 レイアウト分析結果

ファイル: slides.md
総スライド数: 25

🔍 検出された問題

1. スライド 7: リスト項目過多
   - 現在: 7項目
   - 推奨: 4項目以内
   - 修正案: 2スライドに分割

2. スライド 12: テキストオーバーフロー
   - 現在: 420文字
   - 推奨: 300文字以内
   - 修正案: 要約または分割

3. スライド 18: タイトル間隔不足
   - 問題: *** がない
   - 修正案: *** と <div class="mt-5"></div> を追加

✅ 修正を適用しますか？
```

### ステップ9: 実装ループ

ユーザー承認後、tasklist.mdの全タスクが完了するまで実行:

1. タスクリストを読み込む
2. 未完了タスクを確認
3. 先頭の未完了タスクを実行:

**修正例:**

a. **リスト項目過多の修正**:
```markdown
# 元のスライド
---
---

# スライドタイトル

- 項目1
- 項目2
- 項目3
- 項目4
- 項目5
- 項目6
- 項目7

# 修正後（2スライドに分割）
---
---

# スライドタイトル (1/2)

***

<div class="mt-5"></div>

<div class="text-xl">

- 項目1
- 項目2
- 項目3
- 項目4

</div>

---

# スライドタイトル (2/2)

***

<div class="mt-5"></div>

<div class="text-xl">

- 項目5
- 項目6
- 項目7

</div>
```

b. **画像とテキストのバランス修正**:
```markdown
# 元のスライド
---
---

# スライドタイトル

テキスト内容

![大きな画像](./images/big.png)

# 修正後（two-colsレイアウト）
---
layout: two-cols
---

# スライドタイトル

***

<div class="mt-5"></div>

<div class="text-xl">

テキスト内容

</div>

::right::

![画像](./images/big.png)
```

c. **タイトル間隔の修正**:
```markdown
# 元のスライド
---
---

# スライドタイトル
本文内容

# 修正後
---
---

# スライドタイトル

***

<div class="mt-5"></div>

本文内容
```

4. タスクを`[x]`に更新

**例外処理:**
- ファイルが存在しない → エラーメッセージ
- レイアウトパターンが見つからない → defaultを使用
- カスタムスタイルがある → 可能な限り維持
- 自動修正が困難 → 手動修正を提案

### ステップ10: ビルドチェック

修正後、ビルドで検証:
```bash
bash scripts/check-layout.sh
```

ビルドエラーがあれば修正を繰り返す。

### ステップ11: プレビュー確認

開発サーバーで表示を確認:
- レイアウトが正しいか
- 文字サイズが適切か
- 余白が適切か
- 画像が正しく表示されるか

### ステップ12: 振り返りとドキュメント更新

1. tasklist.mdに申し送り事項を記載

2. git commitで保存:
```bash
git add [対象ファイル]
git commit -m "Fix layout issues in [ファイル名]

Fixed issues:
- [修正内容のサマリー]

Co-Authored-By: Claude Sonnet 4.5 <noreply@anthropic.com>"
```

3. 開発サーバーをクリーンアップ（必要に応じて）:
```bash
bash scripts/cleanup.sh
```

## 完了条件

- 対象スライド分析済み
- 問題検出済み
- 修正計画作成済み
- ユーザー承認取得
- tasklist.md全タスク完了
- ビルドチェック成功
- プレビュー確認済み
- 申し送り事項記載済み
- git commit完了

## 検出ルール

### リスト項目数チェック
- 4項目以内: OK
- 5項目: 警告
- 6項目以上: エラー（分割推奨）

### テキスト量チェック
- 200文字以内: OK
- 201-300文字: 警告
- 301文字以上: エラー（要約または分割推奨）

### 段落数チェック
- 2段落以内: OK
- 3段落: 警告
- 4段落以上: エラー（箇条書きまたは分割推奨）

### タイトル間隔チェック
- `***`と`<div class="mt-5"></div>`がある: OK
- どちらかがない: 警告
- 両方ない: エラー

### フォントサイズチェック
- `text-xl`以上: OK
- `text-lg`: 警告
- `text-base`以下: エラー

## よくある問題パターン

1. **リスト項目過多** (最も一般的)
   - 原因: 情報を1スライドに詰め込みすぎ
   - 修正: 2スライドに分割

2. **テキストオーバーフロー**
   - 原因: 長すぎる説明文
   - 修正: 要約、箇条書き化、または分割

3. **画像とテキストのバランス不良**
   - 原因: 不適切なレイアウト
   - 修正: two-cols、image-rightに変更

4. **タイトル間隔不足**
   - 原因: `***`と余白の欠如
   - 修正: `***`と`<div class="mt-5"></div>`を追加

5. **不適切なレイアウト選択**
   - 原因: コンテンツに合わないレイアウト
   - 修正: `format/layout-patterns.md`から最適なパターンを選択

## 参照ドキュメント
- `docs/style-guide.md`: スタイルガイド
- `format/layout-patterns.md`: レイアウトパターン集（40種類）
- `CLAUDE.md`: プロジェクト全体のルール
- `scripts/check-layout.sh`: レイアウトチェックスクリプト
- `scripts/start-server.sh`: 開発サーバー起動スクリプト
- `scripts/cleanup.sh`: クリーンアップスクリプト
