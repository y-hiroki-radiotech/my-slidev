# Layout Fix Skill

## 概要
スライドのレイアウト崩れを検出して自動修正するスキルです。

## 使用方法
```
/layout-fix [対象ファイル]
```

### 例
```
/layout-fix slides.md
/layout-fix pages/flowchart.md
```

## 処理フロー

### 1. 事前準備
- 対象ファイルの存在確認
- 現在の状態をgit commitで保存
- 開発サーバーを起動（既に起動していない場合）

### 2. レイアウト分析
各スライドについて以下をチェック

#### 2-1. コンテンツ量の確認
- **縦5項目以上**: リストが5個以上ある場合は分割を提案
- **テキストオーバーフロー**: 文字数が多すぎる場合は警告
- **画像サイズ**: 画像が大きすぎる/小さすぎる場合は調整

#### 2-2. レイアウトの整合性
- **タイトルと本文の間隔**: `***` と `<div class="mt-5"></div>` の確認
- **レイアウト指定**: フロントマターのlayout設定が適切か確認
- **画像配置**: 画像がレイアウトに合っているか確認

#### 2-3. スタイルの一貫性
- **フォントサイズ**: 本文が28pt以上か確認
- **色の使用**: プライマリカラーが適切に使われているか
- **余白**: mt-5, mb-5などの間隔が適切か

### 3. 問題の検出

#### よくある問題パターン
1. **リスト項目過多**
   - 症状: 5個以上のリストアイテム
   - 修正: 2つのスライドに分割

2. **テキストオーバーフロー**
   - 症状: 長すぎる文章、段落
   - 修正: 要約または分割

3. **画像とテキストのバランス不良**
   - 症状: 画像が大きすぎてテキストが読めない
   - 修正: two-colsレイアウトやimage-rightレイアウトに変更

4. **タイトル間隔不足**
   - 症状: タイトルと本文が詰まっている
   - 修正: `***` と `<div class="mt-5"></div>` を追加

5. **不適切なレイアウト選択**
   - 症状: コンテンツに合わないレイアウト
   - 修正: `format/layout-patterns.md` から最適なパターンを選択

### 4. 修正案の提示
- 検出された問題をリスト化
- 各問題に対する修正案を提示
- プレビューを表示

### 5. 修正の適用
- ユーザー承認を待つ
- 承認後に修正を適用
- 再度レイアウトをチェック

### 6. 検証
- 開発サーバーで表示を確認
- 問題が解決されているか確認
- 必要に応じて再修正

## 使用スクリプト

### scripts/start-server.sh
開発サーバーを起動
```bash
npm run dev
```

### scripts/check-layout.sh
レイアウトをチェック（ビルドで検証）
```bash
npm run build
```

### scripts/cleanup.sh
サーバーを停止してクリーンアップ
```bash
pkill -f "slidev"
rm -rf dist/
```

## 検出ルール

### 1. リスト項目数チェック
```markdown
# 問題のある例
- 項目1
- 項目2
- 項目3
- 項目4
- 項目5
- 項目6  ← 6個以上は警告
```

### 2. テキスト量チェック
- 1スライドあたりの文字数: 300文字以内を推奨
- 段落数: 3段落以内を推奨

### 3. 画像サイズチェック
- 画像の幅: レイアウトに応じて適切なサイズ
- two-colsの場合: 50%程度
- image-rightの場合: 40%程度

### 4. 余白チェック
- タイトル後に `***` + `<div class="mt-5"></div>` があるか
- セクション間に適切な余白があるか

## 修正例

### Before (問題あり)
```markdown
---
---

# スライドタイトル
以下の項目があります
- 項目1
- 項目2
- 項目3
- 項目4
- 項目5
- 項目6
- 項目7
![大きな画像](./images/big.png)
```

### After (修正後)
```markdown
---
layout: two-cols
---

# スライドタイトル (1/2)

***

<div class="mt-5"></div>

<div class="text-xl">

- 項目1
- 項目2
- 項目3
- 項目4

</div>

::right::

![画像](./images/big.png)

---

# スライドタイトル (2/2)

***

<div class="mt-5"></div>

<div class="text-xl">

- 項目5
- 項目6
- 項目7

</div>
```

## 連携スキル

### slide-style-rector との連携
```
1. /slide-style-rector でスタイル整形
2. /layout-fix でレイアウト崩れを確認
3. 問題があれば修正を提案
```

### prepare-pdf との連携
```
1. /layout-fix でレイアウト確認
2. 問題を修正
3. /prepare-pdf でPDF出力
```

## 参照ファイル
- `format/layout-patterns.md`: レイアウトパターン集
- `docs/style-guide.md`: スタイルガイド
- `slides.md`: 対象スライドファイル
- `CLAUDE.md`: プロジェクト全体の指示

## 出力形式

### レポート例
```
📊 レイアウト分析結果

ファイル: slides.md
総スライド数: 25

🔍 検出された問題

1. スライド 7: リスト項目過多
   - 現在: 7項目
   - 推奨: 4項目以内
   - 修正案: 2スライドに分割

2. スライド 12: テキストオーバーフロー
   - 現在: 420文字
   - 推奨: 300文字以内
   - 修正案: 要約または分割

3. スライド 18: タイトル間隔不足
   - 問題: *** がない
   - 修正案: *** と <div class="mt-5"></div> を追加

✅ 修正を適用しますか？
```

## 注意事項
- 自動修正は保守的に行う
- ユーザーの意図を尊重
- 既存のカスタムスタイルは維持
- 修正前に必ずgit commitを実行

## エラーハンドリング
- ファイルが存在しない場合はエラーメッセージ
- サーバー起動失敗時は手動起動を促す
- ビルドエラーがある場合は内容を表示
- git commit失敗時は処理を中断

## 期待される効果
- レイアウト崩れの早期発見
- 一貫性のあるスライド
- 読みやすいプレゼンテーション
- PDF出力時の品質向上
